#!/bin/sh
# SPDX-FileCopyrightText: 2022 Caleb La Grange <thonkpeasant@protonmail.com>
# SPDX-FileCopyrightText: 2023 Leah Rowe <leah@libreboot.org>
# SPDX-License-Identifier: GPL-3.0-only

git_name="lbmkplaceholder"
git_email="placeholder@lbmkplaceholder.com"

main()
{
	if [ $# -gt 0 ]; then
		if [ "${1}" = "clean" ]; then
			clean
		fi
	else
		set_placeholder

		# Check coreboot as well to prevent errors during building
		if [ -d coreboot ]; then
			for x in coreboot/*; do
				if [ ! -d "${x}" ]; then
					continue
				fi
				cd "${x}"
				set_placeholder
				cd -
			done
		fi
	fi
}

set_placeholder()
{
	# Check if username and or email is set.
	if ! git config user.name || git config user.email ; then
		git config user.name \
				|| git config user.name "${git_name}"
		git config user.email \
				|| git config user.email "${git_email}"
	fi
}

clean()
{
	if [ "$(git config user.name)" = "${git_name}" ]; then
		git config --unset user.name
	fi

	if [ "$(git config user.email)" = "${git_email}" ]; then
		git config --unset user.email
	fi
}

main $@
